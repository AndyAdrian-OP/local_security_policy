$DEBUG = $true
$DEBUGFILE = "c:\passwordpolicy_test.txt"

If ($DEBUG) {
	echo "Start Password Policy Check..." >> $DEBUGFILE
}

$SecInf = "secbackup.inf"
secedit /export /cfg $file /quiet

$Policy = "<%= @mapping['name'] %>"
$Setting = <%= @setting %>

If ($DEBUG) {
	echo "Policy: $Policy" >> $DEBUGFILE
	echo "Setting: $Setting >> $DEBUGFILE
}

$ActualSettingLine = Select-String -Simple "$Policy" $file 
$ActualSetting = $ActualSettingLine -split "= "

$SettingIndex = [array]::IndexOf($ActualSetting,$Setting)
if ($SettingIndex -eq -1) {
	If ($DEBUG) {
		echo "Setting is different Actual: $ActualSetting, Desired $Setting" >> $DEBUGFILE
	}
		exit 1
	}	
}

If ($DEBUG) {
	echo "Setting Exact Match" >> $DEBUGFILE
}
exit 0

del $file
